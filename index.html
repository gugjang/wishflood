<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>WishFlood</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg, #a8edea, #fed6e3);
  margin: 0;
  padding: 0;
}

header {
  background: #2dd4bf;
  color: white;
  padding: 20px;
  text-align: center;
  font-size: 28px;
  font-weight: bold;
}

.container {
  max-width: 800px;
  margin: 20px auto;
  padding: 10px;
}

.card {
  background: white;
  border-radius: 12px;
  padding: 15px;
  margin-bottom: 20px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

input, textarea {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

button {
  margin-top: 10px;
  padding: 10px 14px;
  border: none;
  border-radius: 8px;
  background: #2dd4bf;
  color: white;
  cursor: pointer;
}

button:hover {
  background: #14b8a6;
}

.reaction {
  cursor: pointer;
  color: #14b8a6;
  font-weight: bold;
}

.comment {
  margin-top: 5px;
  padding-left: 10px;
  font-size: 14px;
}

.answer img, .answer video {
  max-width: 100%;
  border-radius: 8px;
  margin-top: 5px;
}
</style>
</head>

<body>

<header>WishFlood</header>

<div class="container">

  <div class="card">
    <h3>ì†Œì› ì ê¸°</h3>
    <textarea id="wishInput" placeholder="ì˜ˆ: ê·€ì—¬ìš´ ê³ ì–‘ì´ ê·¸ë¦¼ ë³´ê³ ì‹¶ë‹¤"></textarea>
    <button onclick="addWish()">ì†Œì› ë“±ë¡</button>
  </div>

  <div id="wishList"></div>

</div>

<script>
/* ===== ë‹‰ë„¤ì„ (ê°€ì§œ ë¡œê·¸ì¸) ===== */
let nickname = localStorage.getItem("nickname");
if (!nickname) {
  nickname = prompt("ë‹‰ë„¤ì„ ì…ë ¥");
  if (!nickname) nickname = "Anonymous";
  localStorage.setItem("nickname", nickname);
}

/* ===== ë°ì´í„° ===== */
let wishes = JSON.parse(localStorage.getItem("wishes") || "[]");
let reactions = JSON.parse(localStorage.getItem("reactions") || "{}");

/* ===== ì†Œì› ì¶”ê°€ ===== */
function addWish() {
  const text = document.getElementById("wishInput").value.trim();
  if (!text) return;

  wishes.unshift({
    text,
    answers: [],
    comments: [],
    likes: 0
  });

  save();
  document.getElementById("wishInput").value = "";
}

/* ===== ì‘ë‹µ ì¶”ê°€ ===== */
function addAnswer(i) {
  const link = document.getElementById("answer-"+i).value.trim();
  if (!link) return;

  wishes[i].answers.push(link);
  save();
}

/* ===== ëŒ“ê¸€ ì¶”ê°€ ===== */
function addComment(i) {
  const input = document.getElementById("comment-"+i);
  const text = input.value.trim();
  if (!text) return;

  wishes[i].comments.push({ name: nickname, text });
  save();
}

/* ===== ë°˜ì‘ (1ì¸ 1íšŒ) ===== */
function likeWish(i) {
  const key = nickname + "-" + i;
  if (reactions[key]) return alert("ì´ë¯¸ ë°˜ì‘í•¨");

  reactions[key] = true;
  wishes[i].likes++;
  save();
}

/* ===== ë Œë” ===== */
function render() {
  const list = document.getElementById("wishList");
  list.innerHTML = "";

  wishes.sort((a,b)=>b.likes-a.likes);

  wishes.forEach((w,i)=>{
    list.innerHTML += `
    <div class="card">
      <h3>ğŸ™ ${w.text}</h3>

      <div class="reaction" onclick="likeWish(${i})">ğŸ‘ ${w.likes}</div>

      <div class="answer">
        ${w.answers.map(a=>{
          if (a.match(/\.(jpg|png|gif)$/)) return `<img src="${a}">`;
          if (a.match(/\.(mp4|webm)$/)) return `<video controls src="${a}"></video>`;
          return `<a href="${a}" target="_blank">${a}</a>`;
        }).join("")}
      </div>

      <input id="answer-${i}" placeholder="ê·¸ë¦¼/ì˜ìƒ/ë°ˆ ë§í¬">
      <button onclick="addAnswer(${i})">ì†Œì› ë“¤ì–´ì£¼ê¸°</button>

      <hr>

      ${w.comments.map(c=>`<div class="comment"><b>${c.name}</b>: ${c.text}</div>`).join("")}
      <input id="comment-${i}" placeholder="ëŒ“ê¸€">
      <button onclick="addComment(${i})">ëŒ“ê¸€</button>
    </div>`;
  });
}

/* ===== ì €ì¥ ===== */
function save() {
  localStorage.setItem("wishes", JSON.stringify(wishes));
  localStorage.setItem("reactions", JSON.stringify(reactions));
  render();
}

render();
</script>

</body>
</html>
